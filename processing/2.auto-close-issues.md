Certainly. **Updated write-up:**

---

# Auto-Link and Auto-Close Issues on PRs to Dev Branches (`dev-2.0`)

**Issue:** [#7975](https://github.com/processing/p5.js/issues/7975)
**Pull Requests:**

- [p5.js PR #7989](https://github.com/processing/p5.js/pull/7989)
- [p5.js-website PR #919](https://github.com/processing/p5.js-website/pull/919)

## Problem

GitHubâ€™s built-in auto-close behavior (`Fixes #`, `Closes #`) only works for PRs merged into the **default branch**. This caused problems:

- PRs merged into `2.0` or `dev-2.0` did not auto-link or auto-close issues
- Contributors had to close issues manually
- Example: [PR #7971](https://github.com/processing/p5.js/pull/7971) failed to close [Issue #7905](https://github.com/processing/p5.js/issues/7905)

## Objective

- Enable auto-close for issues referenced in PRs merged into `2.0` or `dev-2.0`
- Parse PR body for closing keywords
- Automatically close referenced issues using the GitHub API

## Initial Solution

- Added `.github/workflows/auto-close-issues.yml` in both `p5.js` and `p5.js-website`
- Workflow used `actions/github-script` with custom regex to parse PR descriptions, extract issue references, and close them via GitHub API
- Relied on `GITHUB_TOKEN` for authentication
- Logged warnings for malformed or missing issue references

## Outcome

- Issues now auto-close on PR merges into non-default branches (`dev-2.0`, `2.0`)
- Reduces manual work for contributors
- Keeps project boards cleaner and feedback cycles shorter

## Technical Challenges

- GitHub does not natively support this for non-default branches
- Required custom parsing and API calls
- Needed to handle malformed descriptions, missing references, and multiple linked issues

## Update on Approach

During review, maintainers raised a concern:

- Inline scripts in workflows are harder to maintain across multiple repos
- Preferred approach: encapsulate the logic in a **dedicated GitHub Action repository**, then call that action in both `p5.js` and `p5.js-website`

### Resolution

- A new repo `processing/branch-pr-close-issue` was created for this action
- Both `p5.js` and `p5.js-website` workflows were updated to use:

  ```yaml
  - name: Close linked issues
    uses: processing/branch-pr-close-issue@v1
  ```

- This ensures consistency and long-term maintainability
- Any fixes or improvements to the closing logic can now be made in one place and applied across projects
