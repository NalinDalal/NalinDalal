# Shader Modification Shortcuts in p5.js (`dev-2.0`)

**Issue:** [#7993](https://github.com/processing/p5.js/issues/7993)  
**Pull Request:** [#8020](https://github.com/processing/p5.js/pull/8020)

---

### TL;DR: Use `create*Shader({...})` instead of `base*Shader().modify({...})`

---

## Problem

Creating and modifying shaders in `p5.strands` previously required verbose and repetitive syntax, such as:

```js
let myShader = baseMaterialShader().modify(() => { ... });
````

This created usability issues:

* Easy to forget `()` since `baseMaterialShader` looks like a variable, not a function
* Repeated `.modify()` boilerplate across shader types
* Not intuitive for new users customizing shaders

---

## Objective

* Reduce the boilerplate for modifying base shaders
* Make it easier and cleaner to use custom shader hooks
* Provide more intuitive APIs while preserving backwards compatibility

---

## Solution

Introduced new **shortcut functions** that internally call `.modify()` on each base shader:

* `createMaterialShader(modifier)`
* `createFilterShader(modifier)`
* `createNormalShader(modifier)`
* `createColorShader(modifier)`
* `createStrokeShader(modifier)`

All of these are exported from a new file:

```
src/webgl/modifyShaderShortcuts.js
```

Also included:

```js
attachCreateShaderShortcuts(p5Instance)
```

to inject these into the `p5` prototype for global sketch use.

---

## Usage

### Direct Function Usage

```js
let myShader = createMaterialShader({
  // custom hooks here
});
```

Equivalent to:

```js
let myShader = baseMaterialShader().modify({
  // same hooks
});
```

---

### Attaching to p5 Prototype

For global access inside any p5 sketch:

```js
import { attachCreateShaderShortcuts } from './src/webgl/modifyShaderShortcuts.js';
attachCreateShaderShortcuts(p5);
```

Now you can just call:

```js
let myShader = createMaterialShader({ ... });
```

---

## Benefits

âœ… **Reduced Boilerplate** â€” no need for `baseShader().modify()` syntax
âœ… **Improved Clarity** â€” shortcut names clarify intent and reduce user confusion
âœ… **Easier Onboarding** â€” new users can write shaders with fewer gotchas
âœ… **Modular Design** â€” shortcuts live in a dedicated file, easy to maintain or extend

---

## Example

```js
// Old way
let myShader = baseMaterialShader().modify({
  // hooks
});

// New way
let myShader = createMaterialShader({
  // same hooks
});
```

---

## How to Test

1. Import the `modifyShaderShortcuts.js` file
2. Use one of the shortcut functions in your sketch
3. Confirm shader behaves exactly as expected
4. (Optional) Use `attachCreateShaderShortcuts(p5)` and test in global mode

---

## Docs

A new file was added:
ğŸ“„ `docs/learn/ShaderModificationShortcuts.md`
â€” contains usage, purpose, and testing steps

---

# p5.js Shader Shortcut API Documentation

The new `create*Shader` functions (e.g., `createMaterialShader`, `createFilterShader`, etc.) are convenient shortcuts for creating custom shaders in p5.js. They are equivalent to calling `.modify()` on the corresponding base shader, but use a more intuitive creation pattern.

---

## Usage Example

```js
let myShader = createMaterialShader({
  modifyFragment(frag) {
    // custom fragment code
    frag.color = [frag.texCoord, 0, 1];
    return frag;
  },
  addUniform('u_time', 'float'),
});
```

---

## Available Shortcut Functions

* `createMaterialShader`
* `createFilterShader`
* `createColorShader`
* `createStrokeShader`
* `createNormalShader`
* etc.

---

## Callback Methods

Inside the callback object, you can use methods like:

* `modifyFragment()` â€” customize fragment shader logic
* `modifyVertex()` â€” customize vertex shader logic
* `addUniform()` â€” add custom uniforms
* You can also use:

  * `declarations` (GLSL code for shared variables/functions)
  * `vertexDeclarations` / `fragmentDeclarations`
  * Direct GLSL hook overrides (e.g., `'Vertex getWorldInputs': '...'`)

---

## Equivalence Note

> These functions are shorthand for calling `.modify()` on the corresponding base shader.
> For example:
> `createMaterialShader({...})` is equivalent to `baseMaterialShader().modify({...})`.

---

## Advanced Usage

For full details on what you can do inside the callback, see the [modify() documentation](https://github.com/processing/p5.js/wiki/Shaders-Reference#modify).

---

## Instance Mode Example

```js
new p5((sketch) => {
  let myShader;

  sketch.setup = function() {
    sketch.createCanvas(200, 200, sketch.WEBGL);
    myShader = sketch.createMaterialShader({
      modifyFragment(frag) {
        frag.color = [frag.texCoord, 0, 1];
        return frag;
      },
      addUniform('u_time', 'float'),
    }, { sketch });
  }

  sketch.draw = function() {
    sketch.background(255);
    sketch.noStroke();
    sketch.shader(myShader);
    sketch.plane(sketch.width, sketch.height);
  }
});
```

---

## GLSL Direct Example

You can also override hooks directly with GLSL code:

```js
let myShader = createMaterialShader({
  declarations: 'uniform float time;',
  'Vertex getWorldInputs': `(Vertex inputs) {
    inputs.position.y += 20. * sin(time * 0.001 + inputs.position.x * 0.05);
    return inputs;
  }`
});
```

---

## Uniforms Example

```js
let myShader = createMaterialShader({
  uniforms: {
    'float time': () => millis()
  },
  'Vertex getWorldInputs': `(Vertex inputs) {
    inputs.position.y += 20. * sin(time * 0.001 + inputs.position.x * 0.05);
    return inputs;
  }`
});
```
